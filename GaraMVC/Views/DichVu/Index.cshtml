@model IEnumerable<GaraMVC.Models.DichVu>

@{
    ViewData["Title"] = "Danh sách dịch vụ";
}

<!-- Breadcrumb -->
<div class="flex-wrap-box gap14 mb-24">
    <div class="page-title">
        <h3>Dịch vụ</h3>
        <ul class="breadcrumbs">
            <li><a asp-controller="Home" asp-action="Index">Dashboard</a></li>
            <li><i class="fas fa-chevron-right"></i></li>
            <li>Dịch vụ</li>
        </ul>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show mb-20" role="alert">
        <i class="fas fa-check-circle me-2"></i>@TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="wg-box">
    <div class="flex-wrap-box gap10 mb-24">
        <div class="wg-filter flex-grow">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Tìm kiếm dịch vụ..." onkeyup="filterTable()">
            </div>
        </div>
        <a asp-action="Create" class="btn-add tf-button style-1">
            <i class="fas fa-plus"></i> Thêm dịch vụ
        </a>
    </div>

    <div class="wg-table table-responsive">
        <table class="table table-striped" id="dataTable">
            <thead>
                <tr>
                    <th>Dịch vụ</th>
                    <th>Mã DV</th>
                    <th>Đơn giá</th>
                    <th>Mô tả</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    @foreach (var item in Model)
                    {
                        var icons = new[] { "fa-oil-can", "fa-spray-can", "fa-cogs", "fa-car-battery", "fa-wrench", "fa-tools" };
                        var colors = new[] { "2377FC", "22C55E", "FF9F43", "7367F0", "FF5200", "00CFE8" };
                        var idx = item.Id % 6;
                        <tr>
                            <td>
                                <div class="product-item gap14">
                                    <div class="image">
                                        @if (!string.IsNullOrEmpty(item.HinhAnh))
                                        {
                                            <img src="@item.HinhAnh" alt="@item.TenDichVu">
                                        }
                                        else
                                        {
                                            <div style="width:50px;height:50px;background:#@colors[idx];border-radius:8px;display:flex;align-items:center;justify-content:center;">
                                                <i class="fas @icons[idx]" style="color:white;font-size:20px;"></i>
                                            </div>
                                        }
                                    </div>
                                    <div class="flex flex-column">
                                        <span class="name">@item.TenDichVu</span>
                                    </div>
                                </div>
                            </td>
                            <td><span class="fw-semibold">#@item.Id</span></td>
                            <td><span class="fw-semibold text-primary">@item.Gia.ToString("N0")₫</span></td>
                            <td><span class="text-secondary">@(item.MoTa?.Length > 50 ? item.MoTa.Substring(0, 50) + "..." : item.MoTa ?? "-")</span></td>
                            <td>
                                @if (item.TrangThai)
                                {
                                    <span class="badge-status success">Đang cung cấp</span>
                                }
                                else
                                {
                                    <span class="badge-status danger">Ngừng cung cấp</span>
                                }
                            </td>
                            <td>
                                <div class="list-icon-function">
                                    <a asp-action="Details" asp-route-id="@item.Id" class="item eye" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a asp-action="Edit" asp-route-id="@item.Id" class="item edit" title="Chỉnh sửa">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a asp-action="Delete" asp-route-id="@item.Id" class="item trash" title="Xóa">
                                        <i class="fas fa-trash-alt"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center py-4">
                            <div class="empty-state">
                                <i class="fas fa-tools fa-3x text-muted mb-3"></i>
                                <p class="text-muted">Chưa có dịch vụ nào</p>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="divider"></div>
    <div class="flex-wrap-box gap10">
        <div class="text-tiny">Hiển thị @Model?.Count() dịch vụ</div>
        <ul class="wg-pagination">
            <li><a href="#"><i class="fas fa-chevron-left"></i></a></li>
            <li><a href="#" class="active">1</a></li>
            <li><a href="#"><i class="fas fa-chevron-right"></i></a></li>
        </ul>
    </div>
</div>

@section Scripts {
<script>
function filterTable() {
    var input = document.getElementById("searchInput");
    var filter = input.value.toLowerCase();
    var table = document.getElementById("dataTable");
    var tr = table.getElementsByTagName("tr");
    
    for (var i = 1; i < tr.length; i++) {
        var td = tr[i].getElementsByTagName("td");
        var found = false;
        for (var j = 0; j < td.length; j++) {
            if (td[j]) {
                var txtValue = td[j].textContent || td[j].innerText;
                if (txtValue.toLowerCase().indexOf(filter) > -1) {
                    found = true;
                    break;
                }
            }
        }
        tr[i].style.display = found ? "" : "none";
    }
}
</script>
}
